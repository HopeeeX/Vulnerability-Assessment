"use client"

import React, { useEffect, useState } from "react";
import Pagination from "./Pagination";
import DeleteButton from "./DeleteButton";
import { useAppSelector } from "@/lib/hooks";

const Table = () => {
    const [records, setRecords] = useState([])
    const access_token = useAppSelector((state) => state.user.access_token)

    useEffect(() => {
        async function fetchRecords(){
            const headers = new Headers()
        headers.append("Authorization", `Bearer ${access_token}`)
            
            const response = await fetch("/api/reports", {
                headers:headers
            })
            const data = await response.json()
            if(data.reports) {
                setRecords(data.reports)
            }
            
        }

        fetchRecords()

    }, [records])
    return (
        <div className="overflow-x-auto">
            <table className="table">
                {/* head */}
                <thead className="bg-[#F4F4FB]">
                    <tr>
                        <th>ID</th>
                        <th>Type</th>
                        <th>Title</th>
                        <th>Description</th>
                        <th>Option</th>
                    </tr>
                </thead>
                <tbody>
                    {records.map((record, index) => (                    
                    <tr key={index}>
                    <td>{record.uuid}</td>
                    <td>{record.vulnerability_type}</td>
                    <td>{record.title}</td>
                    <td>{record.description}</td>
                    <DeleteButton uuid={record.uuid}/>
                </tr>))}
                </tbody>
            </table>
            <Pagination/>
        </div>
    );
};

export default Table;
